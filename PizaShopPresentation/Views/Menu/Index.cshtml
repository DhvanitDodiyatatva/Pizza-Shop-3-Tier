@model PizzaShopRepository.ViewModels.MenuViewModel
@{
  ViewData["Title"] = "Menu";
  var firstCategoryId = Model.Categories.FirstOrDefault(c => c.IsDeleted != true)?.Id;
}

<div class="Users-content my-1 p-xl-5 p-lg-4 p-md-4 p-sm-4 p-4">
  <div class="d-flex align-items-center justify-content-between my-2">
    <div>
      <div class="fw-bolder fs-2 page-text">Menu</div>
    </div>
    <div class="d-flex">
      <a href="@Url.Action("Dashboard", "Home")"><button
          class="btn btn-main bg-primary rounded-2 ms-1 text-white fs-6 d-none d-lg-block"
          type="submit">Back</button></a>
      <a href="@Url.Action("Dashboard", "Home")"><button
          class="btn btn-main bg-primary rounded- ms-1 text-white fs-6 d-block d-lg-none" type="submit">
          << /button></a>
    </div>
  </div>

  <div class="row mb-3 upper-div rounded-2 shadow py-3 d-flex">
    <ul class="nav nav-underline">
      <li class="nav-item">
        <a class="nav-link custom-tag mx-3 active" id="item-tab" data-bs-toggle="tab" data-bs-target="#item-tab-pane"
          type="button" role="tab" aria-controls="item-tab-pane" aria-selected="true">
          <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-list-ul"
            viewBox="0 0 16 16">
            <path fill-rule="evenodd"
              d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2" />
          </svg> Items
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link custom-tag mx-3 text-decoration-none text-black" id="modifier-tab" data-bs-toggle="tab"
          data-bs-target="#modifier-tab-pane" type="button" role="tab" aria-controls="modifier-tab-pane"
          aria-selected="false">
          <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor"
            class="bi bi-ui-checks-grid" viewBox="0 0 16 16">
            <path
              d="M2 10h3a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1m9-9h3a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-3a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1m0 9a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1zm0-10a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h3a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zM2 9a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h3a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2zm7 2a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2h-3a2 2 0 0 1-2-2zM0 2a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm5.354.854a.5.5 0 1 0-.708-.708L3 3.793l-.646-.647a.5.5 0 1 0-.708.708l1 1a.5.5 0 0 0 .708 0z" />
          </svg> Modifiers
        </a>
      </li>
    </ul>
  </div>

  <div class="row content-div rounded-2 shadow">
    <div class="tab-content w-100">
      <!-- Item Tab -->
      <div class="tab-pane fade show active" id="item-tab-pane" role="tabpanel" aria-labelledby="item-tab">
        <div class="row ">
          <div id="category-section" class="col-xl-3 col-lg-4 col-md-12 col-12 ps-3  pe-2 category-section"
            style="background:  rgba(215,237,255,1) 100%;">
            <div class="row d-flex py-3 pe-3">
              <div class="d-flex align-items-center fw-bolder fs-5 justify-content-between page-text">
                Category
                <button type="button" class="btn bg-white btn-outline-dark text-black" data-bs-toggle="modal"
                  data-bs-target="#addCategoryModal">
                  <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" fill="currentColor"
                    class="bi bi-plus-lg" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                      d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2" />
                  </svg>
                </button>
              </div>
            </div>
            @await Html.PartialAsync("_CategoryList", Model)
          </div>

          <!-- Content Section -->
          <div id="content-section" class="col-xl-9 col-lg-8 col-md-12 col-12 p-2">
            <div class="row menu-content">
              <div class="col d-flex align-items-center" id="toggle-container">
                <svg id="categoryToggle" xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
                  class="bi bi-list-ul me-2" viewBox="0 0 16 16">
                  <path fill-rule="evenodd"
                    d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2" />
                </svg>
                <div class="fw-bolder fs-5 page-text">Items</div>
              </div>
            </div>
            <div class="row">
              <div class="d-flex justify-content-end">
                <form class="d-flex align-items-center me-2 rounded-end-3" role="search">
                  <div class="input-group position-relative">
                    <input class="form-control" type="search" placeholder="Search" aria-label="Search"
                      id="itemSearch" />
                    <span class="search-img-desktop position-absolute">
                      <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" fill="currentColor"
                        class="bi bi-search" viewBox="0 0 16 16">
                        <path
                          d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0" />
                      </svg>
                    </span>
                  </div>
                </form>
                <button class="btn btn-outline-secondary rounded-2 fs-6" id="deleteSelectedItems" type="button">
                  <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                    class="bi bi-trash3-fill" viewBox="0 0 16 16">
                    <path
                      d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5m-5 0v1h4v-1a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5M4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06m6.53-.528a.5.5 0 0 0-.528.47l-.5 8.5a.5.5 0 0 0 .998.058l.5-8.5a.5.5 0 0 0-.47-.528M8 4.5a.5.5 0 0 0-.5.5v8.5a.5.5 0 0 0 1 0V5a.5.5 0 0 0-.5-.5" />
                  </svg>
                </button>
                <button type="button" class="btn btn-main btn-primary d-none d-lg-block ms-2" data-bs-toggle="modal"
                  data-bs-target="#addItemModal">+ New Item</button>
                <button class="btn btn-main bg-primary rounded-2 ms-2 text-white fs-6 d-block d-lg-none"
                  data-bs-toggle="modal" data-bs-target="#addItemModal">+</button>
              </div>
            </div>
            <div class="content-div table-responsive" id="itemListContainer">
              @* Initial load with first category items *@
              @await Html.PartialAsync("_ItemList", Model.Items.Where(i => i.CategoryId == firstCategoryId &&
              !i.IsDeleted).ToList())
            </div>
          </div>
        </div>
      </div>

      <!-- Modifier Tab (Placeholder for now) -->
      <div class="tab-pane fade" id="modifier-tab-pane" role="tabpanel" aria-labelledby="modifier-tab">
        <p>Modifiers tab content goes here.</p>
      </div>
    </div>
  </div>
</div>

<!-- Add Category Modal -->
<div class="modal fade" id="addCategoryModal" tabindex="-1" aria-labelledby="addCategoryModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="addCategoryModalLabel">Add Category</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="addCategoryForm" action="@Url.Action("CreateCategory", "Menu")" method="post">
        <div class="modal-body">
          <div class="form-floating mb-3">
            <input type="text" class="form-control" id="categoryName" name="Name" placeholder="Category Name"
              required />
            <label for="categoryName">Name</label>
          </div>
          <div class="form-floating mb-3">
            <input type="text" class="form-control" id="categoryDescription" name="Description"
              placeholder="Description" />
            <label for="categoryDescription">Description</label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Save</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Edit Category Modal -->
<div class="modal fade" id="editCategoryModal" tabindex="-1" aria-labelledby="editCategoryModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="editCategoryModalLabel">Edit Category</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="editCategoryForm" action="@Url.Action("UpdateCategory", "Menu")" method="post">
        <div class="modal-body">
          <input type="hidden" id="editCategoryId" name="Id" />
          <div class="form-floating mb-3">
            <input type="text" class="form-control" id="editCategoryName" name="Name" placeholder="Category Name"
              required />
            <label for="editCategoryName">Name</label>
          </div>
          <div class="form-floating mb-3">
            <input type="text" class="form-control" id="editCategoryDescription" name="Description"
              placeholder="Description" />
            <label for="editCategoryDescription">Description</label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Save</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Add Item Modal -->
<div class="modal fade" id="addItemModal" tabindex="-1" aria-labelledby="addItemModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="addItemModalLabel">Add New Menu Item</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="addItemForm" action="@Url.Action("CreateItem", "Menu")" method="post">
        <div class="modal-body">
          <div class="row g-2 p-1">
            <div class="col-xl-8 col-lg-12 col-md-12 col-12">
              <div class="form-floating mb-3">
                <input type="text" class="form-control" id="itemName" name="Name" placeholder="Item Name" required />
                <label for="itemName">Name</label>
              </div>
              <div class="form-floating mb-3">
                <input type="text" class="form-control" id="itemDescription" name="Description"
                  placeholder="Description" />
                <label for="itemDescription">Description</label>
              </div>
              <div class="row">
                <div class="col-xl-3 col-lg-3 col-md-6 col-sm-12 gy-2">
                  <div class="form-floating">
                    <select class="form-select" id="itemCategoryId" name="CategoryId" aria-label="Category">
                      <option value="">Select Category</option>
                      @foreach (var category in Model.Categories)
                      {
                        <option value="@category.Id">@category.Name</option>
                      }
                    </select>
                    <label for="itemCategoryId">Category</label>
                  </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-md-6 col-sm-12 gy-2">
                  <div class="form-floating mb-3">
                    <input type="number" step="0.01" class="form-control" id="itemPrice" name="Price"
                      placeholder="Price" required />
                    <label for="itemPrice">Price</label>
                  </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-md-6 col-sm-12 gy-2">
                  <div class="form-floating">
                    <select class="form-select" id="itemType" name="ItemType" required>
                      <option value="">Select Type</option>
                      <option value="Veg">Veg</option>
                      <option value="Non-Veg">Non-Veg</option>
                    </select>
                    <label for="itemType">Item Type</label>
                  </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-md-6 col-sm-12 gy-2">
                  <div class="form-floating mb-3">
                    <input type="number" class="form-control" id="itemQuantity" name="Quantity"
                      placeholder="Quantity" />
                    <label for="itemQuantity">Quantity</label>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6 col-6 gy-2">
                  <div class="d-flex align-items-center">
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" role="switch" id="itemIsAvailable"
                        name="IsAvailable" style="width: 50px; height: 30px;" value="true" />
                      <label class="form-check-label" for="itemIsAvailable"></label>
                    </div>
                    <div>Available</div>
                  </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-md-6 col-sm-12 gy-2">
                  <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="itemUnit" name="Unit" placeholder="Unit" />
                    <label for="itemUnit">Unit</label>
                  </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-md-6 col-sm-12 gy-2">
                  <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="itemShortCode" name="ShortCode"
                      placeholder="Short Code" />
                    <label for="itemShortCode">Short Code</label>
                  </div>
                </div>
              </div>
              <div class="form-floating">
                <input type="text" class="form-control" id="itemImageUrl" name="ImageUrl" placeholder="Image URL" />
                <label for="itemImageUrl">Image URL</label>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Save</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Edit Item Modal -->
<div class="modal fade" id="editItemModal" tabindex="-1" aria-labelledby="editItemModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="editItemModalLabel">Edit Menu Item</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="editItemForm" action="@Url.Action("UpdateItem", "Menu")" method="post">
        <div class="modal-body">
          <input type="hidden" id="editItemId" name="Id" />
          <div class="row g-2 p-1">
            <div class="col-xl-8 col-lg-12 col-md-12 col-12">
              <div class="form-floating mb-3">
                <input type="text" class="form-control" id="editItemName" name="Name" placeholder="Item Name"
                  required />
                <label for="editItemName">Name</label>
              </div>
              <div class="form-floating mb-3">
                <input type="text" class="form-control" id="editItemDescription" name="Description"
                  placeholder="Description" />
                <label for="editItemDescription">Description</label>
              </div>
              <div class="row">
                <div class="col-xl-3 col-lg-3 col-md-6 col-sm-12 gy-2">
                  <div class="form-floating">
                    <select class="form-select" id="editItemCategoryId" name="CategoryId" aria-label="Category">
                      <option value="">Select Category</option>
                      @foreach (var category in Model.Categories)
                      {
                        <option value="@category.Id">@category.Name</option>
                      }
                    </select>
                    <label for="editItemCategoryId">Category</label>
                  </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-md-6 col-sm-12 gy-2">
                  <div class="form-floating mb-3">
                    <input type="number" step="0.01" class="form-control" id="editItemPrice" name="Price"
                      placeholder="Price" required />
                    <label for="editItemPrice">Price</label>
                  </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-md-6 col-sm-12 gy-2">
                  <div class="form-floating">
                    <select class="form-select" id="editItemType" name="ItemType" required>
                      <option value="">Select Type</option>
                      <option value="Veg">Veg</option>
                      <option value="Non-Veg">Non-Veg</option>
                    </select>
                    <label for="editItemType">Item Type</label>
                  </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-md-6 col-sm-12 gy-2">
                  <div class="form-floating mb-3">
                    <input type="number" class="form-control" id="editItemQuantity" name="Quantity"
                      placeholder="Quantity" />
                    <label for="editItemQuantity">Quantity</label>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6 col-6 gy-2">
                  <div class="d-flex align-items-center">
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" role="switch" id="editItemIsAvailable"
                        name="IsAvailable" style="width: 50px; height: 30px;" value="true" />
                      <label class="form-check-label" for="editItemIsAvailable"></label>
                    </div>
                    <div>Available</div>
                  </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-md-6 col-sm-12 gy-2">
                  <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="editItemUnit" name="Unit" placeholder="Unit" />
                    <label for="editItemUnit">Unit</label>
                  </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-md-6 col-sm-12 gy-2">
                  <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="editItemShortCode" name="ShortCode"
                      placeholder="Short Code" />
                    <label for="editItemShortCode">Short Code</label>
                  </div>
                </div>
              </div>
              <div class="form-floating">
                <input type="text" class="form-control" id="editItemImageUrl" name="ImageUrl" placeholder="Image URL" />
                <label for="editItemImageUrl">Image URL</label>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Save</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Delete Item Modal -->
<div class="modal fade" id="deleteItemModal" tabindex="-1" aria-labelledby="deleteItemModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="deleteItemModalLabel">Delete Confirmation</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body d-flex align-items-center justify-content-center flex-column">
        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="currentColor"
          class="bi bi-exclamation-triangle" viewBox="0 0 16 16">
          <path
            d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.15.15 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.2.2 0 0 1-.054.06.1.1 0 0 1-.066.017H1.146a.1.1 0 0 1-.066-.017.2.2 0 0 1-.054-.06.18.18 0 0 1 .002-.183L7.884 2.073a.15.15 0 0 1 .054-.057m1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767z" />
          <path
            d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z" />
        </svg>
        <p>Are you sure you want to delete this item?</p>
      </div>
      <div class="modal-footer d-flex justify-content-center align-items-center">
        <form id="deleteItemForm" action="@Url.Action("DeleteItem", "Menu")" method="post">
          <input type="hidden" id="deleteItemId" name="id" />
          <button type="submit" class="btn btn-primary">Yes</button>
        </form>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
      </div>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function () {
    // Assign JSON data to variables
    const categories = @Html.Raw(Json.Serialize(Model.Categories));
    const items = @Html.Raw(Json.Serialize(Model.Items));

    // Initial load with first category highlighted
    const firstCategoryId = @firstCategoryId;
    if (firstCategoryId) {
      $('.category-link[data-category-id="' + firstCategoryId + '"]').addClass('active');
    }

    // Toggle category section
    $("#categoryToggle").click(function () {
      var categorySection = $("#category-section");
      var contentSection = $("#content-section");
      var toggleContainer = $("#toggle-container");

      if (window.innerWidth <= 991) {
        categorySection.toggleClass("category-visible");
        toggleContainer.toggleClass("toggle-move");
      } else {
        if (categorySection.css("display") === "none" || categorySection.hasClass("d-none")) {
          categorySection.css("display", "block").removeClass("d-none");
          if (categorySection.hasClass("col-xl-3")) {
            contentSection.removeClass("col-12").addClass("col-xl-9 col-lg-8");
          }
        } else {
          categorySection.css("display", "none").addClass("d-none");
          contentSection.removeClass("col-xl-9 col-lg-8").addClass("col-12");
        }
      }
    });

    // Select all items
    $("#selectAllItems").change(function () {
      $("input[name='selectedItems']").prop("checked", this.checked);
    });

    // Delete selected items
    $("#deleteSelectedItems").click(function () {
      const selectedIds = $("input[name='selectedItems']:checked").map(function () {
        return $(this).val();
      }).get();

      if (selectedIds.length > 0 && confirm("Are you sure you want to delete the selected items?")) {
        $.ajax({
          url: '@Url.Action("DeleteItems", "Menu")',
          type: 'POST',
          contentType: 'application/json',
          data: JSON.stringify(selectedIds),
          success: function () {
            location.reload();
          },
          error: function () {
            alert("Error deleting items.");
          }
        });
      }
    });

    // Category selection with AJAX
    $(".category-link").click(function (e) {
      e.preventDefault();
      const categoryId = $(this).data("category-id");

      $.ajax({
        url: '@Url.Action("GetItemsByCategory", "Menu")',
        type: 'GET',
        data: { categoryId: categoryId },
        success: function (data) {
          $("#itemListContainer").html(data);
          attachModalListeners(); // Re-attach modal event listeners
        },
        error: function () {
          alert("Error loading items.");
        }
      });

      // Highlight selected category
      $(".category-link").removeClass("active");
      $(this).addClass("active");
    });

    // Populate edit category modal
    $(".edit-category-link").click(function () {
      const categoryId = $(this).data("category-id");
      const category = categories.find(c => c.id === categoryId);
      if (category) {
        $("#editCategoryId").val(category.id);
        $("#editCategoryName").val(category.name);
        $("#editCategoryDescription").val(category.description || "");
      }
    });

    // Function to attach modal listeners
    function attachModalListeners() {
      $(".edit-item-link").click(function () {
        const itemId = $(this).data("item-id");
        const item = items.find(i => i.id === itemId);
        if (item) {
          $("#editItemId").val(item.id);
          $("#editItemName").val(item.name);
          $("#editItemDescription").val(item.description || "");
          $("#editItemCategoryId").val(item.categoryId || "");
          $("#editItemPrice").val(item.price);
          $("#editItemType").val(item.itemType);
          $("#editItemQuantity").val(item.quantity || "");
          $("#editItemUnit").val(item.unit || "");
          $("#editItemShortCode").val(item.shortCode || "");
          $("#editItemImageUrl").val(item.imageUrl || "");
          $("#editItemIsAvailable").prop("checked", item.isAvailable || false);
        }
      });

      $(".delete-item-btn").click(function () {
        const itemId = $(this).data("item-id");
        $("#deleteItemId").val(itemId);
      });
    }

    // Attach modal listeners on initial load
    attachModalListeners();

    // Debounce search (still client-side for simplicity)
    let searchTimeout;
    $("#itemSearch").on("input", function () {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        const searchTerm = $(this).val().toLowerCase();
        $("#itemTableBody tr").each(function () {
          const name = $(this).find("td:nth-child(2)").text().toLowerCase();
          $(this).toggle(name.includes(searchTerm));
        });
      }, 300);
    });
  });
</script>