@{
    ViewData["Title"] = "Orders";
}

<div class="Orders-content mt-0 p-xl-5 p-lg-4 p-md-4 p-sm-4 p-4">
    <div class="my-2 z-0">
        <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="d-flex align-items-center">
                <div class="fw-bolder fs-2 page-text me-2">Orders</div>
            </div>
            <div class="d-flex align-items-center position-relative z-0">
                <form class="d-flex align-items-center me-2" role="search" id="searchForm">
                    <div class="input-group position-relative form-floating">
                        <input class="form-control" type="search" placeholder="Search" aria-label="Search" id="Search"
                            style="max-width: 350px;" name="searchQuery" />
                        <label for="Search">Search</label>
                        <span class="search-img-desktop position-absolute"
                            style="right: 10px; top: 50%; transform: translateY(-50%);">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-search" viewBox="0 0 16 16">
                                <path
                                    d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0" />
                            </svg>
                        </span>
                    </div>
                </form>
                <div class="me-2">
                    <div class="form-floating">
                        <select class="form-select" aria-label="Status filter" style="max-width: 150px;"
                            id="statusFilter">
                            <option selected value="">ALL STATUS</option>
                            <option value="pending">Pending</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                </div>
                <div class="me-2">
                    <div class="form-floating">
                        <select class="form-select" aria-label="Time filter" style="max-width: 150px;" id="timeFilter">
                            <option selected value="">ALL TIME</option>
                            <option value="today">Today</option>
                            <option value="this_week">This Week</option>
                            <option value="this_month">This Month</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-main text-white py-3" style="padding: 0.375rem 0.75rem;">
                    <img src="~/images/export.png" style="height: 20px; width: 20px;">
                    Export
                </button>
            </div>
        </div>

        <div class="d-flex align-items-center position-relative z-0 justify-content-end">
            <div class="form-floating me-2">
                <input type="date" class="form-control" style="max-width: 350px;" id="fromDate" />
                <label for="fromDate">From date</label>
            </div>
            <div class="form-floating me-2">
                <input type="date" class="form-control" id="toDate" style="max-width: 350px;" />
                <label for="toDate">To date</label>
            </div>
            <button class="btn btn-main text-white me-2 py-3" style="padding: 0.375rem 0.75rem;"
                id="searchButton">Search</button>
            <button class="btn btn-main text-white py-3" style="padding: 0.375rem 0.75rem;"
                id="clearButton">Clear</button>
        </div>
    </div>
    <div id="orderListContainer">
        <!-- Order list will be loaded here via AJAX -->
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            loadOrders();

            // Handle search form submission
            $('#searchForm').on('submit', function (e) {
                e.preventDefault();
                loadOrders();
            });

            // Handle search button click
            $('#searchButton').on('click', function (e) {
                e.preventDefault();
                loadOrders();
            });

            // Handle clear button click
            $('#clearButton').on('click', function (e) {
                e.preventDefault();
                $('#Search').val('');
                $('#statusFilter').val('');
                $('#timeFilter').val('');
                $('#fromDate').val('');
                $('#toDate').val('');
                loadOrders();
            });

            // Handle filter changes
            $('#statusFilter, #timeFilter, #fromDate, #toDate').on('change', function () {
                loadOrders();
            });

            // Handle sorting and pagination clicks
            $(document).on('click', '.sort-link, .page-link, .dropdown-item', function (e) {
                e.preventDefault();
                var url = $(this).attr('href');
                if (url) {
                    loadOrders(url);
                }
            });
        });

        function loadOrders(url) {
            var searchQuery = $('#Search').val();
            var statusFilter = $('#statusFilter').val();
            var timeFilter = $('#timeFilter').val();
            var fromDate = $('#fromDate').val();
            var toDate = $('#toDate').val();
            var baseUrl = url || '@Url.Action("GetOrderList", "Orders")';

            $.ajax({
                url: baseUrl,
                type: 'GET',
                data: {
                    searchQuery: searchQuery,
                    statusFilter: statusFilter,
                    timeFilter: timeFilter,
                    fromDate: fromDate,
                    toDate: toDate,
                    sortColumn: getParameterByName('sortColumn', baseUrl) || '',
                    sortDirection: getParameterByName('sortDirection', baseUrl) || '',
                    page: getParameterByName('page', baseUrl) || 1,
                    pageSize: getParameterByName('pageSize', baseUrl) || 5
                },
                success: function (data) {
                    $('#orderListContainer').html(data);
                },
                error: function () {
                    alert('Error loading orders');
                }
            });
        }

        // Helper function to get query parameters from URL
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, '\\$&');
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }
    </script>
}